<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All+ Unit 2自學王 (Interactive)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .font-serif { font-family: 'Merriweather', serif; }
        
        /* Flip Card Styles */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* Highlight Animation */
        .highlight-word {
            background-color: #fef08a; /* yellow-200 */
            border-bottom: 2px solid #fde047; /* yellow-300 */
            cursor: pointer;
            transition: all 0.2s;
            padding: 0 4px;
            margin: 0 1px;
            border-radius: 4px;
            font-weight: 600;
            color: #854d0e;
        }
        .highlight-word:hover {
            background-color: #facc15;
            color: #000;
            transform: translateY(-1px);
        }

        /* Hide scrollbar for tab navigation */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animation */
        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
            animation: slide-up 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col pb-24 md:pb-0">

    <!-- Header -->
    <header class="bg-blue-700 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-3 md:py-4">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold leading-tight">All+ Unit 2自學王</h1>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <nav class="flex space-x-2 bg-blue-800/50 p-1 rounded-lg overflow-x-auto no-scrollbar">
                <button onclick="switchTab('read')" id="tab-read" class="tab-btn flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md transition-colors text-sm font-medium bg-white text-blue-700 shadow-sm whitespace-nowrap">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                    Reading 閱讀
                </button>
                <button onclick="switchTab('vocab')" id="tab-vocab" class="tab-btn flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md transition-colors text-sm font-medium text-blue-100 hover:bg-blue-600/50 whitespace-nowrap">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m5 8 5-5 5 5"/><path d="m12 13 7 7-7-7z"/><path d="M12 3v10"/><path d="m19 8-5-5-5 5"/><path d="m22 13-7 7-7-7z"/><path d="M12 21V11"/></svg>
                    Vocab 單字
                </button>
                <button onclick="switchTab('quiz')" id="tab-quiz" class="tab-btn flex-1 flex items-center justify-center gap-2 py-2 px-3 rounded-md transition-colors text-sm font-medium text-blue-100 hover:bg-blue-600/50 whitespace-nowrap">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>
                    Quiz 測驗
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="app-content" class="flex-grow max-w-4xl mx-auto w-full p-4 md:p-6 mb-20">
        <!-- Content injected via JS -->
    </main>

    <!-- Dictionary Panel (Sticky Bottom) -->
    <div id="dict-panel" class="fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] transform translate-y-full transition-transform duration-300 z-50">
        <div class="max-w-4xl mx-auto p-4 flex items-center justify-between">
            <div class="flex-1">
                <div class="flex items-baseline gap-3 mb-1">
                    <h3 id="dict-word" class="text-2xl font-bold text-slate-800 font-serif">word</h3>
                    <span id="dict-pos" class="text-sm font-mono bg-blue-100 text-blue-700 px-2 py-0.5 rounded">n.</span>
                </div>
                <p id="dict-def" class="text-slate-600 text-lg">中文定義</p>
            </div>
            <div class="flex items-center gap-4">
                <button id="dict-audio-btn" class="p-3 rounded-full bg-blue-50 text-blue-600 hover:bg-blue-100 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                </button>
                <button onclick="closeDict()" class="p-2 text-slate-400 hover:text-slate-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Data & Logic -->
    <script>
        // --- DATA ---
        
        // Vocabulary Dictionary
        const vocabDict = {
            "celebration": { part: "n.", def: "慶祝；頌揚", example: "The party was a celebration of their victory.", trans: "這場派對是為了慶祝他們的勝利。" },
            "athletic": { part: "adj.", def: "運動的；體育的", example: "She showed great athletic ability on the field.", trans: "她在場上展現了極佳的運動能力。" },
            "cooperation": { part: "n.", def: "合作", example: "Peaceful cooperation is essential for the team.", trans: "和平合作對團隊至關重要。" },
            "subsequently": { part: "adv.", def: "隨後；接著", example: "He was arrested and subsequently released.", trans: "他被逮捕，隨後被釋放。" },
            "sacrifices": { part: "n.", def: "祭祀；犧牲", example: "Many sacrifices were made during the war.", trans: "戰爭期間做出了許多犧牲。" },
            "combat": { part: "n.", def: "戰鬥；格鬥", example: "Soldiers are trained for unarmed combat.", trans: "士兵受過徒手格鬥訓練。" },
            "excluded": { part: "v.", def: "排除；被拒絕", example: "Women were excluded from voting in the past.", trans: "過去女性被排除在投票權之外。" },
            "gender": { part: "n.", def: "性別", example: "Discrimination based on gender is illegal.", trans: "基於性別的歧視是違法的。" },
            "bronze": { part: "n.", def: "青銅；銅牌", example: "He won a bronze medal in swimming.", trans: "他在游泳比賽中獲得了銅牌。" },
            "monetary": { part: "adj.", def: "金錢的；貨幣的", example: "The item has little monetary value.", trans: "這件物品幾乎沒有金錢價值。" },
            "preserving": { part: "v.", def: "維護；保存", example: "We must preserve our natural resources.", trans: "我們必須保護我們的自然資源。" },
            "dignity": { part: "n.", def: "尊嚴", example: "Every human being should be treated with dignity.", trans: "每個人都應該被有尊嚴地對待。" },
            "harmony": { part: "n.", def: "和諧", example: "They lived together in perfect harmony.", trans: "他們非常和諧地生活在一起。" }
        };

        const sentences = [
            {
                id: 1,
                english: "From ancient religious festival to modern celebration of sporting achievement, the Olympics have changed considerably over time.",
                chinese: "從古代宗教節慶到現代對於體育成就的頌揚，奧林匹克運動會隨著時間發生了很大的變化。",
                keywords: ["celebration"]
            },
            {
                id: 2,
                english: "Today, they feature both athletic excellence and peaceful cooperation among nations.",
                chinese: "如今，奧運不僅展現運動員的卓越表現，也促進各國之間的和平合作。",
                keywords: ["athletic", "cooperation"]
            },
            {
                id: 3,
                english: "The first Olympics took place in 776 BC in the Greek city of Olympia, where they were subsequently held every four years.",
                chinese: "首次奧林匹克運動會於西元前七七六年在希臘城市奧林匹亞舉行，此後每四年舉辦一次。",
                keywords: ["subsequently"]
            },
            {
                id: 4,
                english: "Originally created to honor the god Zeus, the games held deep religious meaning.",
                chinese: "奧運最初是為了敬奉宙斯神而設立，具有深厚的宗教意義。",
                keywords: []
            },
            {
                id: 5,
                english: "Athletic competition was paired with sacrifices and singing, and people believed Zeus decided the victors.",
                chinese: "體育競賽與祭祀和歌唱活動相結合，且人們相信勝利者由宙斯決定。",
                keywords: ["sacrifices"]
            },
            {
                id: 6,
                english: "The stadion, a roughly 180-meter sprint, was the only event for the first 13 Olympics.",
                chinese: "在最初的十三屆奧運會中，體育場短跑（約一百八十公尺）是唯一的比賽項目。",
                keywords: []
            },
            {
                id: 7,
                english: "Gradually, new contests were introduced, including wrestling, boxing, pankration (a combat sport), and chariot racing.",
                chinese: "漸漸地，新的競賽陸續引進，包括摔角、拳擊、潘克拉辛（一種格鬥運動）以及戰車競賽。",
                keywords: ["combat"]
            },
            {
                id: 8,
                english: "Winners were crowned with olive wreaths and were often paid handsomely by their home cities.",
                chinese: "勝利者會戴上橄欖枝花冠，並常獲家鄉城市重賞。",
                keywords: []
            },
            {
                id: 9,
                english: "Only freeborn Greek men could participate, and it’s thought that they competed naked.",
                chinese: "當時只有自由出身的希臘男性可參賽，且據說他們是裸體參加比賽。",
                keywords: []
            },
            {
                id: 10,
                english: "Women may have been excluded from even watching the Olympics.",
                chinese: "女性甚至可能被禁止觀看奧運賽事。",
                keywords: ["excluded"]
            },
            {
                id: 11,
                english: "However, they had a separate festival, the Heraean Games, honoring the goddess Hera.",
                chinese: "然而，女性則有自己的節慶——赫拉運動會，用以敬奉女神赫拉。",
                keywords: []
            },
            {
                id: 12,
                english: "The games were protected by the Ekecheiria, or “Olympic truce.”",
                chinese: "當時的奧運受到奧林匹克休戰協議（Ekecheiria）的保護。",
                keywords: []
            },
            {
                id: 13,
                english: "Though not always observed, it called for a temporary peace to allow competitors and spectators from different regions to come together and enjoy the games.",
                chinese: "雖然這項協議並非總是遵守，但它呼籲暫時停戰，讓來自不同地區的參賽者與觀眾能齊聚一堂、享受奧運盛事。",
                keywords: []
            },
            {
                id: 14,
                english: "In 1896, the Frenchman Pierre de Coubertin set the stage for the modern Olympic Games by organizing the first Summer Olympics in Athens.",
                chinese: "一八九六年，法國人皮耶．德．古柏坦在雅典籌辦了首屆夏季奧運會，為現代奧運奠定了基礎。",
                keywords: []
            },
            {
                id: 15,
                english: "Currently, there are 43 sports on the Olympic program.",
                chinese: "目前，奧運會共有四十三種運動。",
                keywords: []
            },
            {
                id: 16,
                english: "Winners in each event are given medals (gold, silver, or bronze), and while there’s no official prize money, athletes may receive monetary rewards from their home countries or sponsors.",
                chinese: "每個項目的勝者會獲得獎牌（金牌、銀牌或銅牌），雖然沒有官方獎金，但運動員可能會從自己國家或贊助商那裡獲得獎勵。",
                keywords: ["bronze", "monetary"]
            },
            {
                id: 17,
                english: "Coubertin’s vision for the Olympics went beyond athleticism.",
                chinese: "古柏坦對奧運的願景超越了運動競技本身。",
                keywords: []
            },
            {
                id: 18,
                english: "He believed sport should promote strong moral character.",
                chinese: "他認為體育應培養健全的道德品格。",
                keywords: []
            },
            {
                id: 19,
                english: "Early guiding principles—“encouraging effort,” “preserving human dignity,” and “developing harmony”—remain central today.",
                chinese: "早期的指導原則──「鼓勵努力」、「維護人的尊嚴」以及「培養和諧」──至今仍是核心價值。",
                keywords: ["preserving", "dignity", "harmony"]
            }
        ];

        const quizQuestions = [
            {
                id: 1,
                question: "What was the original purpose of the ancient Olympics?",
                options: ["To win gold medals", "To honor the god Zeus", "To make money for home cities", "To train soldiers for war"],
                correct: 1,
                explanation: "The text states they were 'Originally created to honor the god Zeus'.",
                refSentence: 4
            },
            {
                id: 2,
                question: "Which event was the ONLY one held during the first 13 Olympics?",
                options: ["Chariot racing", "Wrestling", "The stadion (sprint)", "Boxing"],
                correct: 2,
                explanation: "The text says 'The stadion, a roughly 180-meter sprint, was the only event for the first 13 Olympics.'",
                refSentence: 6
            },
            {
                id: 3,
                question: "What is the 'Ekecheiria'?",
                options: ["The name of the winner's crown", "The Olympic truce for peace", "A type of ancient combat sport", "The location of the first games"],
                correct: 1,
                explanation: "The text defines Ekecheiria as the 'Olympic truce' which called for a temporary peace.",
                refSentence: 12
            },
            {
                id: 4,
                question: "Who is considered the founder of the modern Olympic Games?",
                options: ["Zeus", "A Greek King", "Pierre de Coubertin", "An American athlete"],
                correct: 2,
                explanation: "Sentence 14 mentions 'the Frenchman Pierre de Coubertin set the stage for the modern Olympic Games'.",
                refSentence: 14
            }
        ];

        // --- STATE & UTILS ---
        let currentTab = 'read';
        let showChinese = true;
        let quizAnswers = {};
        let quizSubmitted = false;
        const synth = window.speechSynthesis;

        function speak(text) {
            if (synth.speaking) synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            synth.speak(utterance);
        }

        function highlightKeywords(text, keywords) {
            if (!keywords || keywords.length === 0) return text;
            const sortedKeywords = [...keywords].sort((a, b) => b.length - a.length);
            const regex = new RegExp(`\\b(${sortedKeywords.join('|')})\\w*\\b`, 'gi');
            return text.replace(regex, (match) => {
                const lookupKey = match.toLowerCase(); 
                return `<span class="highlight-word" onclick="openDict('${lookupKey}', event)">${match}</span>`;
            });
        }

        // --- Dictionary Logic ---
        function openDict(word, event) {
            if (event) event.stopPropagation();
            
            let data = vocabDict[word.toLowerCase()];
            if (!data) {
                const base = Object.keys(vocabDict).find(k => word.toLowerCase().includes(k));
                if (base) data = vocabDict[base];
            }

            if (data) {
                document.getElementById('dict-word').innerText = word;
                document.getElementById('dict-pos').innerText = data.part;
                document.getElementById('dict-def').innerText = data.def;
                document.getElementById('dict-audio-btn').onclick = () => speak(word);
                
                const panel = document.getElementById('dict-panel');
                panel.classList.remove('translate-y-full');
                
                speak(word);
            }
        }

        function closeDict() {
            document.getElementById('dict-panel').classList.add('translate-y-full');
        }

        // --- RENDER FUNCTIONS ---

        function renderTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const isActive = btn.id === `tab-${currentTab}`;
                if (isActive) {
                    btn.classList.remove('text-blue-100', 'hover:bg-blue-600/50');
                    btn.classList.add('bg-white', 'text-blue-700', 'shadow-sm');
                } else {
                    btn.classList.add('text-blue-100', 'hover:bg-blue-600/50');
                    btn.classList.remove('bg-white', 'text-blue-700', 'shadow-sm');
                }
            });
        }

        function renderReader() {
            const container = document.getElementById('app-content');
            
            let html = `
                <div class="space-y-6 animate-fade-in">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl md:text-3xl font-serif font-bold text-slate-900 mb-2 leading-tight">Ancient Origins, Modern Glory: The Olympic Story</h2>
                        <h3 class="text-lg md:text-xl text-slate-600 font-medium">從古代祭典到現代榮耀：奧運的故事</h3>
                    </div>

                    <!-- Controls -->
                    <div class="bg-white p-3 rounded-xl shadow-sm border border-slate-200 sticky top-16 md:top-20 z-40 flex flex-wrap gap-4 items-center justify-between">
                        <div class="flex items-center gap-4">
                            <!-- Toggle Chinese -->
                            <label class="flex items-center gap-2 cursor-pointer">
                                <div class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${showChinese ? 'bg-blue-600' : 'bg-slate-300'}">
                                    <input type="checkbox" class="sr-only" onchange="toggleChinese()" ${showChinese ? 'checked' : ''}>
                                    <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${showChinese ? 'translate-x-6' : 'translate-x-1'}"></span>
                                </div>
                                <span class="text-sm font-medium text-slate-700">中譯 Translation</span>
                            </label>
                        </div>
                    </div>

                    <!-- Sentences List -->
                    <div class="space-y-4">
            `;

            sentences.forEach(sent => {
                let displayHtml = highlightKeywords(sent.english, sent.keywords);

                html += `
                    <div id="sent-${sent.id}" class="bg-white rounded-lg shadow-sm border border-slate-100 p-4 hover:shadow-md transition-shadow">
                        <div class="flex gap-3">
                            <span class="text-xs font-bold text-slate-300 pt-1 select-none">${sent.id}</span>
                            <div class="flex-1">
                                <p class="text-lg text-slate-800 leading-relaxed font-serif mb-2">${displayHtml}</p>
                                
                                ${showChinese ? `
                                <p class="text-slate-600 text-base leading-relaxed border-l-4 border-blue-100 pl-3 mt-2">${sent.chinese}</p>
                                ` : ''}
                            </div>
                            <button onclick="speak('${sent.english.replace(/'/g, "\\'")}')" class="h-8 w-8 flex items-center justify-center rounded-full text-slate-400 hover:text-blue-600 hover:bg-blue-50 transition-colors flex-shrink-0">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                            </button>
                        </div>
                    </div>
                `;
            });

            html += `</div></div>`;
            container.innerHTML = html;
        }

        function renderVocab() {
            const container = document.getElementById('app-content');
            const wordsArray = Object.keys(vocabDict).map(k => ({ word: k, ...vocabDict[k] }));
            
            // Increased height from h-80 to h-96 for more space
            let html = `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in">`;

            wordsArray.forEach((item, index) => {
                html += `
                <div class="h-96 perspective-1000 cursor-pointer group" onclick="this.querySelector('.card-inner').classList.toggle('rotate-y-180')">
                    <div class="card-inner relative w-full h-full duration-500 transform-style-3d transition-transform">
                        <!-- Front -->
                        <div class="absolute w-full h-full bg-white rounded-2xl shadow-md border-2 border-slate-100 flex flex-col items-center justify-center p-6 backface-hidden group-hover:border-blue-200 transition-colors">
                            <span class="text-xs text-blue-500 font-bold tracking-wider mb-2 uppercase">Tap to flip</span>
                            <h3 class="text-4xl font-bold text-slate-800 mb-2">${item.word}</h3>
                            <span class="inline-block bg-slate-100 text-slate-500 text-sm px-4 py-1.5 rounded-full mb-8 font-mono">${item.part}</span>
                            <button onclick="event.stopPropagation(); speak('${item.word}')" class="p-4 bg-blue-50 text-blue-600 rounded-full hover:bg-blue-100 transition-colors shadow-sm hover:shadow transform hover:scale-110">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                            </button>
                        </div>
                        
                        <!-- Back -->
                        <div class="absolute w-full h-full bg-blue-600 rounded-2xl shadow-md text-white flex flex-col items-start p-8 rotate-y-180 backface-hidden overflow-y-auto">
                            <div class="w-full border-b border-blue-400 pb-4 mb-6 flex justify-between items-baseline">
                                <h3 class="text-3xl font-bold tracking-wide">${item.def}</h3>
                                <span class="font-mono bg-blue-700/50 px-2 py-1 rounded text-sm text-blue-100">${item.part}</span>
                            </div>
                            <div class="text-left w-full space-y-6">
                                <div>
                                    <p class="text-white text-xl font-serif italic leading-relaxed mb-2">"${item.example}"</p>
                                    <p class="text-blue-200 text-lg font-medium">${item.trans}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            });

            html += `</div>`;
            container.innerHTML = html;
        }

        function renderQuiz() {
            const container = document.getElementById('app-content');
            let html = `<div class="max-w-2xl mx-auto space-y-8 animate-fade-in">`;

            quizQuestions.forEach((q, index) => {
                const userAnswer = quizAnswers[q.id];
                
                html += `
                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 md:p-8">
                    <div class="flex items-start gap-4 mb-6">
                        <span class="bg-blue-100 text-blue-700 font-bold rounded-lg w-8 h-8 flex items-center justify-center flex-shrink-0 text-sm">
                            ${index + 1}
                        </span>
                        <h3 class="text-xl font-semibold text-slate-800 pt-1">${q.question}</h3>
                    </div>
                    <div class="space-y-3 pl-0 md:pl-12">
                `;

                q.options.forEach((opt, optIdx) => {
                    let btnClass = "w-full text-left p-4 rounded-xl border-2 transition-all duration-200 flex items-center justify-between group outline-none ";
                    
                    if (quizSubmitted) {
                        if (optIdx === q.correct) {
                            btnClass += "bg-green-50 border-green-500 text-green-700 font-bold";
                        } else if (userAnswer === optIdx) {
                            btnClass += "bg-red-50 border-red-300 text-red-700 opacity-75";
                        } else {
                            btnClass += "border-slate-100 text-slate-400 opacity-50";
                        }
                    } else {
                        if (userAnswer === optIdx) {
                            btnClass += "border-blue-500 bg-blue-50 text-blue-700 font-bold ring-2 ring-blue-200";
                        } else {
                            btnClass += "border-slate-100 text-slate-600 hover:border-blue-200 hover:bg-slate-50";
                        }
                    }

                    // Icon
                    let iconHtml = "";
                    if (quizSubmitted) {
                        if (optIdx === q.correct) iconHtml = `<svg class="text-green-600 h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`;
                        else if (userAnswer === optIdx) iconHtml = `<svg class="text-red-500 h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>`;
                    }

                    const clickHandler = quizSubmitted ? '' : `onclick="selectOption(${q.id}, ${optIdx})"`;

                    html += `
                        <button ${clickHandler} class="${btnClass}" ${quizSubmitted ? 'disabled' : ''}>
                            <span>${opt}</span>
                            ${iconHtml}
                        </button>
                    `;
                });

                // Explanation Block (Visible after submit)
                if (quizSubmitted) {
                    html += `
                        <div class="mt-6 bg-blue-50 rounded-xl p-5 border border-blue-100 animate-slide-up">
                            <div class="flex items-center gap-2 text-blue-800 font-bold mb-2 text-sm uppercase tracking-wide">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                                Explanation 解析
                            </div>
                            <p class="text-blue-900 mb-3">${q.explanation}</p>
                            <button onclick="goToSentence(${q.refSentence})" class="text-sm bg-white border border-blue-200 text-blue-600 px-3 py-1 rounded-full hover:bg-blue-600 hover:text-white transition-colors">
                                參見文章第 ${q.refSentence} 句 &rarr;
                            </button>
                        </div>
                    `;
                }

                html += `</div></div>`;
            });

            // Submit / Score Area
            html += `<div class="flex justify-center pt-4 pb-12">`;
            
            if (!quizSubmitted) {
                const answeredCount = Object.keys(quizAnswers).length;
                const totalCount = quizQuestions.length;
                const isComplete = answeredCount === totalCount;
                
                html += `
                    <button onclick="submitQuiz()" 
                        class="bg-blue-600 text-white px-10 py-4 rounded-full font-bold text-lg shadow-xl hover:bg-blue-700 transition-all transform hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                        ${!isComplete ? 'disabled' : ''}>
                        ${isComplete ? 'Submit Answers 提交答案' : `Answer All Questions (${answeredCount}/${totalCount})`}
                    </button>
                `;
            } else {
                let score = 0;
                quizQuestions.forEach(q => {
                    if (quizAnswers[q.id] === q.correct) score++;
                });
                
                html += `
                    <div class="bg-slate-800 text-white px-10 py-8 rounded-3xl text-center shadow-2xl w-full md:w-auto animate-bounce-in">
                        <p class="text-slate-400 uppercase text-xs font-bold tracking-widest mb-2">FINAL SCORE</p>
                        <div class="text-5xl font-black mb-3 text-yellow-400 font-mono tracking-tight">${score} / ${quizQuestions.length}</div>
                        <button onclick="resetQuiz()" class="text-blue-300 hover:text-white underline text-sm transition-colors">
                            Retake Quiz 重新測驗
                        </button>
                    </div>
                `;
            }
            
            html += `</div></div>`;
            container.innerHTML = html;
        }

        // --- ACTIONS ---

        window.switchTab = function(tab) {
            currentTab = tab;
            renderTabs();
            if (tab === 'read') renderReader();
            else if (tab === 'vocab') renderVocab();
            else if (tab === 'quiz') renderQuiz();
            window.scrollTo({ top: 0, behavior: 'smooth' });
            closeDict();
        };

        window.toggleChinese = function() {
            showChinese = !showChinese;
            renderReader();
        };

        window.selectOption = function(qId, optIdx) {
            quizAnswers[qId] = optIdx;
            renderQuiz();
        };

        window.submitQuiz = function() {
            quizSubmitted = true;
            renderQuiz();
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        };

        window.resetQuiz = function() {
            quizAnswers = {};
            quizSubmitted = false;
            renderQuiz();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.goToSentence = function(sentId) {
            switchTab('read');
            // Allow time for render
            setTimeout(() => {
                const el = document.getElementById(`sent-${sentId}`);
                if (el) {
                    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    el.classList.add('ring-2', 'ring-yellow-400', 'bg-yellow-50');
                    setTimeout(() => el.classList.remove('ring-2', 'ring-yellow-400', 'bg-yellow-50'), 2000);
                }
            }, 100);
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            switchTab('read');
        });

    </script>
</body>
</html>